// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model users {
  regd_no String @id
  roll_no String @unique
  name String
  password String @default("1000")
  balance Int  // in paise
  room_no Room?
  class String // TODO
  status Status
  photo String @default("/images/profile_pics/profile.png")
  room  rooms? @relation(fields:[room_no], references: [room_no])
  transactions transactions[]
  role UserRoles
  leaders room_leaders[]
}


model rooms {
  room_no Room @id
  members users[]
  room_leaders room_leaders[]
  subscriptions subscriptions[]
}

model room_leaders {
  regd_no String @id
  room_no Room  // check this
  profile users @relation(fields:[regd_no], references: [regd_no])
  rooms rooms @relation(fields:[room_no], references: [room_no])

}

model transactions {
  id Int @id @default(autoincrement())
  regd_no String
  student users @relation(fields:[regd_no], references: [regd_no])
  amount Int
  date DateTime @default(now())
  particulars String?

}

// room number and type should be key
model subscriptions {
  room_no Room
  room rooms @relation(fields:[room_no], references:[room_no])
  type Subs
  details subscription_details @relation(fields:[type], references:[id])
  @@id([room_no, type])
  
}

model subscription_details {
  id Subs @id
  amount Int // in paise
  department Dept
  active subscriptions[]

}

enum Subs {
  THE_HINDU
  ECONOMIC_TIMES
  // ask
}

enum Status {
  ACTIVE
  DISABLED
}

enum UserRoles {
  STUDENT
  PHOTOCOPY
  ACCOUNTANT
  TEACHER_ADMIN
  CENTRAL_ADMIN
}

// while updating schema also update actions.ts
enum Room {
  A1
  A2
  A3
  A4
  A5
  A6
  A7
  A8
  B1
  B2
  B3
  B4
  B5
  B6
  B7
  B8
  C1
  C2
  C3
  C4
  C5
  C6
  C7
  C8
  S13
}

enum Dept {
  NEWSPAPER
  PHOTOCOPY
}
